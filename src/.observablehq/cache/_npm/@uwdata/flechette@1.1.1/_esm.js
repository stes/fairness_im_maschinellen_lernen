/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/@uwdata/flechette@1.1.1/src/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
const t=Uint8Array.of(65,82,82,79,87,49),e={V1:0,V2:1,V3:2,V4:3,V5:4},n={Little:0,Big:1},s={NONE:0,Schema:1,DictionaryBatch:2,RecordBatch:3,Tensor:4,SparseTensor:5},r={Dictionary:-1,NONE:0,Null:1,Int:2,Float:3,Binary:4,Utf8:5,Bool:6,Decimal:7,Date:8,Time:9,Timestamp:10,Interval:11,List:12,Struct:13,Union:14,FixedSizeBinary:15,FixedSizeList:16,Map:17,Duration:18,LargeBinary:19,LargeUtf8:20,LargeList:21,RunEndEncoded:22,BinaryView:23,Utf8View:24,ListView:25,LargeListView:26},i={HALF:0,SINGLE:1,DOUBLE:2},a={DAY:0,MILLISECOND:1},c={SECOND:0,MILLISECOND:1,MICROSECOND:2,NANOSECOND:3},u={YEAR_MONTH:0,DAY_TIME:1,MONTH_DAY_NANO:2},o={Sparse:0,Dense:1},d=Uint8Array,l=Uint16Array,h=Uint32Array,f=BigUint64Array,y=Int8Array,p=Int16Array,I=Int32Array,g=BigInt64Array,b=Float32Array,v=Float64Array;function w(t,e){const n=Math.log2(t)-3;return(e?[y,p,I,g]:[d,l,h,f])[n]}const m=Object.getPrototypeOf(Int8Array);function x(t){return t instanceof m}function O(t){return Array.isArray(t)||x(t)}function L(t){return t===g||t===f}function E(t,e){let n=0,s=t.length;if(s<=2147483648)do{const r=n+s>>>1;t[r]<=e?n=r+1:s=r}while(n<s);else do{const r=Math.trunc((n+s)/2);t[r]<=e?n=r+1:s=r}while(n<s);return n}function D(t,e,n=0){const s=new t.constructor(e);return s.set(t,n),s}function A(t,e,n){for(;t.length<=e;)t=D(t,t.length<<1,n?t.length:0);return t}function N(t,e,n){if(e(t))return t;throw new Error(n(t))}function S(t,e,n){return e=Array.isArray(e)?e:Object.values(e),N(t,(t=>e.includes(t)),n??(()=>`${t} must be one of ${e}`))}function B(t,e){for(const[n,s]of Object.entries(t))if(s===e)return n;return"<Unknown>"}const M=t=>`Unsupported data type: "${B(r,t)}" (id ${t})`,C=(t,e,n=!0,s=null)=>({name:t,type:e,nullable:n,metadata:s});function U(t){return Object.hasOwn(t,"name")&&V(t.type)}function V(t){return"number"==typeof t?.typeId}function T(t,e="",n=!0){return U(t)?t:C(e,N(t,V,(()=>"Data type expected.")),n)}const F=t=>({typeId:t}),j=(t,e,n=!1,s=-1)=>({typeId:r.Dictionary,id:s,dictionary:t,indices:e||$(),ordered:n}),k=()=>F(r.Null),R=(t=32,e=!0)=>({typeId:r.Int,bitWidth:S(t,[8,16,32,64]),signed:e,values:w(t,e)}),z=()=>R(8),_=()=>R(16),$=()=>R(32),Y=()=>R(64),H=()=>R(8,!1),P=()=>R(16,!1),W=()=>R(32,!1),G=()=>R(64,!1),J=(t=2)=>({typeId:r.Float,precision:S(t,i),values:[l,b,v][t]}),X=()=>J(i.HALF),q=()=>J(i.SINGLE),K=()=>J(i.DOUBLE),Q=()=>({typeId:r.Binary,offsets:I}),Z=()=>({typeId:r.Utf8,offsets:I}),tt=()=>F(r.Bool),et=(t,e,n=128)=>({typeId:r.Decimal,precision:t,scale:e,bitWidth:S(n,[128,256]),values:f}),nt=t=>({typeId:r.Date,unit:S(t,a),values:t===a.DAY?I:g}),st=()=>nt(a.DAY),rt=()=>nt(a.MILLISECOND),it=(t=c.MILLISECOND,e=32)=>({typeId:r.Time,unit:S(t,c),bitWidth:S(e,[32,64]),values:32===e?I:g}),at=()=>it(c.SECOND,32),ct=()=>it(c.MILLISECOND,32),ut=()=>it(c.MICROSECOND,64),ot=()=>it(c.NANOSECOND,64),dt=(t=c.MILLISECOND,e=null)=>({typeId:r.Timestamp,unit:S(t,c),timezone:e,values:g}),lt=(t=u.MONTH_DAY_NANO)=>({typeId:r.Interval,unit:S(t,u),values:t===u.MONTH_DAY_NANO?void 0:I}),ht=t=>({typeId:r.List,children:[T(t)],offsets:I}),ft=t=>({typeId:r.Struct,children:Array.isArray(t)&&U(t[0])?t:Object.entries(t).map((([t,e])=>C(t,e)))}),yt=(t,e,n,s)=>(n??=e.map(((t,e)=>e)),{typeId:r.Union,mode:S(t,o),typeIds:n,typeMap:n.reduce(((t,e,n)=>(t[e]=n,t)),{}),children:e.map(((t,e)=>T(t,`_${e}`))),typeIdForValue:s,offsets:I}),pt=t=>({typeId:r.FixedSizeBinary,stride:t}),It=(t,e)=>({typeId:r.FixedSizeList,stride:e,children:[T(t)]}),gt=(t,e)=>({typeId:r.Map,keysSorted:t,children:[e],offsets:I}),bt=(t,e,n=!1)=>gt(n,C("entries",ft([T(t,"key",!1),T(e,"value")]),!1)),vt=(t=c.MILLISECOND)=>({typeId:r.Duration,unit:S(t,c),values:g}),wt=()=>({typeId:r.LargeBinary,offsets:g}),mt=()=>({typeId:r.LargeUtf8,offsets:g}),xt=t=>({typeId:r.LargeList,children:[T(t)],offsets:g}),Ot=(t,e)=>({typeId:r.RunEndEncoded,children:[N(T(t,"run_ends"),(t=>t.type.typeId===r.Int),(()=>"Run-ends must have an integer type.")),T(e,"values")]}),Lt=()=>F(r.BinaryView),Et=()=>F(r.Utf8View),Dt=t=>({typeId:r.ListView,children:[T(t,"value")],offsets:I}),At=t=>({typeId:r.LargeListView,children:[T(t,"value")],offsets:g}),Nt=new v(2),St=Nt.buffer,Bt=new g(St),Mt=new h(St),Ct=new I(St),Ut=new d(St);function Vt(t){return t}function Tt(t){return BigInt(t)}function Ft(t){return L(t)?Tt:Vt}function jt(t){return t/864e5|0}function kt(t){if(t>Number.MAX_SAFE_INTEGER||t<Number.MIN_SAFE_INTEGER)throw Error(`BigInt exceeds integer number representation: ${t}`);return Number(t)}function Rt(t,e){return Number(t/e)+Number(t%e)/Number(e)}const zt=t=>BigInt.asUintN(64,t);function _t(t,e){const n=e<<1;let s;return BigInt.asIntN(64,t[n+1])<0?(s=zt(~t[n])|zt(~t[n+1])<<64n,s=-(s+1n)):s=t[n]|t[n+1]<<64n,s}function $t(t,e){const n=e<<2;let s;return BigInt.asIntN(64,t[n+3])<0?(s=zt(~t[n])|zt(~t[n+1])<<64n|zt(~t[n+2])<<128n|zt(~t[n+3])<<192n,s=-(s+1n)):s=t[n]|t[n+1]<<64n|t[n+2]<<128n|t[n+3]<<192n,s}function Yt(t){if(t!=t)return 32256;Nt[0]=t;const e=(2147483648&Mt[1])>>16&65535;let n=2146435072&Mt[1],s=0;return n>=1089470464?Mt[0]>0?n=31744:(n=(2080374784&n)>>16,s=(1048575&Mt[1])>>10):n<=1056964608?(s=1048576+(1048575&Mt[1]),s=1048576+(s<<(n>>20)-998)>>21,n=0):(n=n-1056964608>>10,s=512+(1048575&Mt[1])>>10),e|n|65535&s}const Ht=new TextDecoder("utf-8"),Pt=new TextEncoder;function Wt(t){return Ht.decode(t)}function Gt(t){return Pt.encode(t)}function Jt(t){return`${"object"==typeof t&&t?function(t){return t instanceof Date}(t)?+t:O(t)?`[${t.map(Jt)}]`:function(t){let e="",n=-1;for(const s in t)++n>0&&(e+=","),e+=`"${s}":${Jt(t[s])}`;return`{${e}}`}(t):t??null}`}const Xt=4;function qt(t,e){return 0!=(t[e>>3]&1<<e%8)}function Kt(t,e){const n=e+ne(t,e),s=n-ne(t,n),r=ee(t,s);return(e,i,a=null)=>{if(e<r){const r=ee(t,s+e);if(r)return i(t,n+r)}return a}}function Qt(t,e){return e}function Zt(t,e){return!!function(t,e){return te(t,e)<<24>>24}(t,e)}function te(t,e){return t[e]}function ee(t,e){return function(t,e){return t[e]|t[e+1]<<8}(t,e)<<16>>16}function ne(t,e){return t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24}function se(t,e){return ne(t,e)>>>0}function re(t,e){return kt(BigInt.asIntN(64,BigInt(se(t,e))+(BigInt(se(t,e+Xt))<<32n)))}function ie(t,e){let n=e+ne(t,e);const s=ne(t,n);return n+=Xt,Wt(t.subarray(n,n+s))}function ae(t,e,n,s){if(!e)return[];const r=e+ne(t,e);return Array.from({length:ne(t,r)},((e,i)=>s(t,r+Xt+i*n)))}const ce=Symbol("rowIndex");function ue(t,e){class n{constructor(t){this[ce]=t}toJSON(){return de(t,e,this[ce])}}const s=n.prototype;for(let n=0;n<t.length;++n){if(Object.hasOwn(s,t[n]))continue;const r=e[n];Object.defineProperty(s,t[n],{get(){return r.at(this[ce])},enumerable:!0})}return t=>new n(t)}function oe(t,e){return n=>de(t,e,n)}function de(t,e,n){const s={};for(let r=0;r<t.length;++r)s[t[r]]=e[r].at(n);return s}class le{static ArrayType=null;constructor({length:t,nullCount:e,type:n,validity:s,values:r,offsets:i,sizes:a,children:c}){this.length=t,this.nullCount=e,this.type=n,this.validity=s,this.values=r,this.offsets=i,this.sizes=a,this.children=c,e&&this.validity||(this.at=t=>this.value(t))}get[Symbol.toStringTag](){return"Batch"}at(t){return this.isValid(t)?this.value(t):null}isValid(t){return qt(this.validity,t)}value(t){return this.values[t]}slice(t,e){const n=e-t,s=Array(n);for(let e=0;e<n;++e)s[e]=this.at(t+e);return s}*[Symbol.iterator](){for(let t=0;t<this.length;++t)yield this.at(t)}}class he extends le{constructor(t){super(t);const{length:e,values:n}=this;this.values=n.subarray(0,e)}slice(t,e){return this.nullCount?super.slice(t,e):this.values.subarray(t,e)}[Symbol.iterator](){return this.nullCount?super[Symbol.iterator]():this.values[Symbol.iterator]()}}class fe extends le{static ArrayType=v}class ye extends le{static ArrayType=Array}class pe extends ye{value(t){return null}}class Ie extends fe{value(t){return kt(this.values[t])}}class ge extends fe{value(t){const e=this.values[t],n=(31744&e)>>10,s=(1023&e)/1024,r=(-1)**((32768&e)>>15);switch(n){case 31:return r*(s?Number.NaN:1/0);case 0:return r*(s?6103515625e-14*s:0)}return r*2**(n-15)*(1+s)}}class be extends ye{value(t){return qt(this.values,t)}}class ve extends le{constructor(t){super(t);const{bitWidth:e,scale:n}=this.type;this.decimal=128===e?_t:$t,this.scale=10n**BigInt(n)}}class we extends ve{static ArrayType=v;value(t){return Rt(this.decimal(this.values,t),this.scale)}}class me extends ve{static ArrayType=Array;value(t){return this.decimal(this.values,t)}}class xe extends ye{constructor(t){super(t),this.source=t}value(t){return new Date(this.source.value(t))}}class Oe extends fe{value(t){return 864e5*this.values[t]}}const Le=Ie;class Ee extends Ie{value(t){return 1e3*super.value(t)}}const De=Ie;class Ae extends Ie{value(t){return Rt(this.values[t],1000n)}}class Ne extends Ie{value(t){return Rt(this.values[t],1000000n)}}class Se extends ye{value(t){return this.values.subarray(t<<1,t+1<<1)}}class Be extends ye{value(t){const e=this.values,n=t<<4;return Float64Array.of(ne(e,n),ne(e,n+4),re(e,n+8))}}const Me=({values:t,offsets:e},n)=>t.subarray(e[n],e[n+1]),Ce=({values:t,offsets:e},n)=>t.subarray(kt(e[n]),kt(e[n+1]));class Ue extends ye{value(t){return Me(this,t)}}class Ve extends ye{value(t){return Ce(this,t)}}class Te extends ye{value(t){return Wt(Me(this,t))}}class Fe extends ye{value(t){return Wt(Ce(this,t))}}class je extends ye{value(t){const e=this.offsets;return this.children[0].slice(e[t],e[t+1])}}class ke extends ye{value(t){const e=this.offsets;return this.children[0].slice(kt(e[t]),kt(e[t+1]))}}class Re extends ye{value(t){const e=this.offsets[t],n=e+this.sizes[t];return this.children[0].slice(e,n)}}class ze extends ye{value(t){const e=this.offsets[t],n=e+this.sizes[t];return this.children[0].slice(kt(e),kt(n))}}class _e extends ye{constructor(t){super(t),this.stride=this.type.stride}}class $e extends _e{value(t){const{stride:e,values:n}=this;return n.subarray(t*e,(t+1)*e)}}class Ye extends _e{value(t){const{children:e,stride:n}=this;return e[0].slice(t*n,(t+1)*n)}}function He({children:t,offsets:e},n){const[s,r]=t[0].children,i=e[n],a=e[n+1],c=[];for(let t=i;t<a;++t)c.push([s.at(t),r.at(t)]);return c}class Pe extends ye{value(t){return He(this,t)}}class We extends ye{value(t){return new Map(He(this,t))}}class Ge extends ye{constructor({typeIds:t,...e}){super(e),this.typeIds=t,this.typeMap=this.type.typeMap}value(t,e=t){const{typeIds:n,children:s,typeMap:r}=this;return s[r[n[t]]].at(e)}}class Je extends Ge{value(t){return super.value(t,this.offsets[t])}}class Xe extends ye{constructor(t,e=oe){super(t),this.names=this.type.children.map((t=>t.name)),this.factory=e(this.names,this.children)}value(t){return this.factory(t)}}class qe extends Xe{constructor(t){super(t,ue)}}class Ke extends ye{value(t){const[{values:e},n]=this.children;return n.at(E(e,t))}}class Qe extends ye{setDictionary(t){return this.dictionary=t,this.cache=t.cache(),this}value(t){return this.cache[this.key(t)]}key(t){return this.values[t]}}class Ze extends ye{constructor({data:t,...e}){super(e),this.data=t}view(t){const{values:e,data:n}=this,s=t<<4;let r=s+4,i=e;const a=ne(i,s);return a>12&&(r=ne(i,s+12),i=n[ne(i,s+8)]),i.subarray(r,r+a)}}class tn extends Ze{value(t){return this.view(t)}}class en extends Ze{value(t){return Wt(this.view(t))}}function nn(t){let e=[];return{add(t){return e.push(t),this},clear:()=>e=[],done:()=>new sn(e,t)}}class sn{constructor(t,e=t[0]?.type){this.type=e,this.length=t.reduce(((t,e)=>t+e.length),0),this.nullCount=t.reduce(((t,e)=>t+e.nullCount),0),this.data=t;const n=t.length,s=new Int32Array(n+1);if(1===n){const[e]=t;s[1]=e.length,this.at=t=>e.at(t)}else for(let e=0,r=0;e<n;++e)s[e+1]=r+=t[e].length;this.offsets=s}get[Symbol.toStringTag](){return"Column"}[Symbol.iterator](){const t=this.data;return 1===t.length?t[0][Symbol.iterator]():function*(t){for(let e=0;e<t.length;++e){const n=t[e][Symbol.iterator]();for(let t=n.next();!t.done;t=n.next())yield t.value}}(t)}at(t){const{data:e,offsets:n}=this,s=E(n,t)-1;return e[s]?.at(t-n[s])}get(t){return this.at(t)}toArray(){const{length:t,nullCount:e,data:n}=this,s=!e&&n[0]instanceof he;const r=n.length;if(s&&1===r)return n[0].values;const i=new(!r||e>0?Array:n[0].constructor.ArrayType??n[0].values.constructor)(t);return s?function(t,e){for(let n=0,s=0;n<e.length;++n){const{values:r}=e[n];t.set(r,s),s+=r.length}return t}(i,n):function(t,e){let n=-1;for(let s=0;s<e.length;++s){const r=e[s];for(let e=0;e<r.length;++e)t[++n]=r.at(e)}return t}(i,n)}cache(){return this._cache??(this._cache=this.toArray())}}class rn{constructor(t,e,n=!1){const s=t.fields.map((t=>t.name));this.schema=t,this.names=s,this.children=e,this.factory=n?ue:oe;const r=[];this.getFactory=t=>r[t]??(r[t]=this.factory(s,e.map((e=>e.data[t]))))}get[Symbol.toStringTag](){return"Table"}get numCols(){return this.names.length}get numRows(){return this.children[0]?.length??0}getChildAt(t){return this.children[t]}getChild(t){const e=this.names.findIndex((e=>e===t));return e>-1?this.children[e]:void 0}selectAt(t,e=[]){const{children:n,factory:s,schema:r}=this,{fields:i}=r;return new rn({...r,fields:t.map(((t,n)=>function(t,e){return null!=e&&e!==t.name?{...t,name:e}:t}(i[t],e[n])))},t.map((t=>n[t])),s===ue)}select(t,e){const n=this.names,s=t.map((t=>n.indexOf(t)));return this.selectAt(s,e)}toColumns(){const{children:t,names:e}=this,n={};return e.forEach(((e,s)=>n[e]=t[s]?.toArray()??[])),n}toArray(){const{children:t,getFactory:e,numRows:n}=this,s=t[0]?.data??[],r=Array(n);for(let t=0,n=-1;t<s.length;++t){const i=e(t);for(let e=0;e<s[t].length;++e)r[++n]=i(e)}return r}*[Symbol.iterator](){const{children:t,getFactory:e}=this,n=t[0]?.data??[];for(let t=0;t<n.length;++t){const s=e(t);for(let e=0;e<n[t].length;++e)yield s(e)}}at(t){const{children:e,getFactory:n,numRows:s}=this;if(t<0||t>=s)return null;const[{offsets:r}]=e,i=E(r,t)-1;return n(i)(t-r[i])}get(t){return this.at(t)}}function an(t,e={}){const{typeId:n,bitWidth:s,precision:i,unit:o}=t,{useBigInt:d,useDate:l,useDecimalBigInt:h,useMap:f,useProxy:y}=e;switch(n){case r.Null:return pe;case r.Bool:return be;case r.Int:case r.Time:case r.Duration:return d||s<64?he:Ie;case r.Float:return i?he:ge;case r.Date:return cn(o===a.DAY?Oe:Le,l&&xe);case r.Timestamp:return cn(o===c.SECOND?Ee:o===c.MILLISECOND?De:o===c.MICROSECOND?Ae:Ne,l&&xe);case r.Decimal:return h?me:we;case r.Interval:return o===u.DAY_TIME?Se:o===u.YEAR_MONTH?he:Be;case r.FixedSizeBinary:return $e;case r.Utf8:return Te;case r.LargeUtf8:return Fe;case r.Binary:return Ue;case r.LargeBinary:return Ve;case r.BinaryView:return tn;case r.Utf8View:return en;case r.List:return je;case r.LargeList:return ke;case r.Map:return f?We:Pe;case r.ListView:return Re;case r.LargeListView:return ze;case r.FixedSizeList:return Ye;case r.Struct:return y?qe:Xe;case r.RunEndEncoded:return Ke;case r.Dictionary:return Qe;case r.Union:return t.mode?Je:Ge}throw new Error(M(n))}function cn(t,e){return e?class extends e{constructor(e){super(new t(e))}}:t}function un(t,e){return{offset:re(t,e),metadataLength:ne(t,e+8),bodyLength:re(t,e+16)}}function on(t,e){return ae(t,e,24,un)}function dn(t,n,s){const r=Kt(t,n);if(r(10,Qt,0))throw new Error("Record batch compression not implemented");const i=s<e.V4?8:0;return{length:r(4,re,0),nodes:ae(t,r(6,Qt),16,((t,e)=>({length:re(t,e),nullCount:re(t,e+8)}))),regions:ae(t,r(8,Qt),16+i,((t,e)=>({offset:re(t,e+i),length:re(t,e+i+8)}))),variadic:ae(t,r(12,Qt),8,re)}}function ln(t,e,n){const s=Kt(t,e);return{id:s(4,re,0),data:s(6,((t,e)=>dn(t,e,n))),isDelta:s(8,Zt,!1)}}function hn(t,e,n,s){S(n,r,M);const d=Kt(t,e);switch(n){case r.Binary:return Q();case r.Utf8:return Z();case r.LargeBinary:return wt();case r.LargeUtf8:return mt();case r.List:return ht(s[0]);case r.ListView:return Dt(s[0]);case r.LargeList:return xt(s[0]);case r.LargeListView:return At(s[0]);case r.Struct:return ft(s);case r.RunEndEncoded:return Ot(s[0],s[1]);case r.Int:return R(d(4,ne,0),d(6,Zt,!1));case r.Float:return J(d(4,ee,i.HALF));case r.Decimal:return et(d(4,ne,0),d(6,ne,0),d(8,ne,128));case r.Date:return nt(d(4,ee,a.MILLISECOND));case r.Time:return it(d(4,ee,c.MILLISECOND),d(6,ne,32));case r.Timestamp:return dt(d(4,ee,c.SECOND),d(6,ie));case r.Interval:return lt(d(4,ee,u.YEAR_MONTH));case r.Duration:return vt(d(4,ee,c.MILLISECOND));case r.FixedSizeBinary:return pt(d(4,ne,0));case r.FixedSizeList:return It(s[0],d(4,ne,0));case r.Map:return gt(d(4,Zt,!1),s[0]);case r.Union:return yt(d(4,ee,o.Sparse),s,ae(t,d(6,Qt),4,ne))}return{typeId:n}}function fn(t,e){const n=ae(t,e,4,((t,e)=>{const n=Kt(t,e);return[n(4,ie),n(6,ie)]}));return n.length?new Map(n):null}function yn(t,e,n){const s=Kt(t,e);return{version:n,endianness:s(4,ee,0),fields:s(6,pn,[]),metadata:s(8,fn)}}function pn(t,e){return ae(t,e,4,In)}function In(t,e){const n=Kt(t,e),s=n(8,te,r.NONE),i=n(10,Qt,0),a=n(12,gn),c=n(14,((t,e)=>function(t,e){const n=ae(t,e,4,In);return n.length?n:null}(t,e)));let u=hn(t,i,s,c);return a&&(a.dictionary=u,u=a),{name:n(4,ie),type:u,nullable:n(6,Zt,!1),metadata:n(16,fn)}}function gn(t,e){if(!e)return null;const n=Kt(t,e);return j(null,n(6,bn,$()),n(8,Zt,!1),n(4,re,0))}function bn(t,e){return hn(t,e,r.Int)}const vn=(t,e)=>`Expected to read ${t} metadata bytes, but only read ${e}.`,wn=(t,e)=>`Expected to read ${t} bytes for message body, but only read ${e}.`,mn=t=>`Unsupported message type: ${t} (${B(s,t)})`;function xn(t,n){let r=ne(t,n)||0;if(n+=Xt,-1===r&&(r=ne(t,n)||0,n+=Xt),0===r)return null;const i=t.subarray(n,n+=r);if(i.byteLength<r)throw new Error(vn(r,i.byteLength));const a=Kt(i,0),c=a(4,ee,e.V1),u=a(6,te,s.NONE),o=a(8,Qt,0),d=a(10,re,0);let l;if(o){const e=u===s.Schema?yn:u===s.DictionaryBatch?ln:u===s.RecordBatch?dn:null;if(!e)throw new Error(mn(u));if(l=e(i,o,c),d>0){const e=t.subarray(n,n+=d);if(e.byteLength<d)throw new Error(wn(d,e.byteLength));l.body=e}}return{version:c,type:u,index:n,content:l}}function On(n){const r=n instanceof ArrayBuffer?new Uint8Array(n):n;return r instanceof Uint8Array&&function(e){if(!e||e.length<4)return!1;for(let n=0;n<6;++n)if(t[n]!==e[n])return!1;return!0}(r)?function(n){const s=n.byteLength-(t.length+4),r=ne(n,s),i=Kt(n,s-r),a=i(4,ee,e.V1),c=i(8,on,[]),u=i(10,on,[]);return{schema:i(6,((t,e)=>yn(t,e,a))),dictionaries:c.map((({offset:t})=>xn(n,t).content)),records:u.map((({offset:t})=>xn(n,t).content)),metadata:i(12,fn)}}(r):function(t){const e=[t].flat();let n;const r=[],i=[];for(const t of e){if(!(t instanceof Uint8Array))throw new Error("IPC data batch was not a Uint8Array.");let e=0;for(;;){const a=xn(t,e);if(null===a)break;if(e=a.index,a.content)switch(a.type){case s.Schema:n||(n=a.content);break;case s.RecordBatch:r.push(a.content);break;case s.DictionaryBatch:i.push(a.content)}}}return{schema:n,dictionaries:i,records:r,metadata:null}}(r)}function Ln(t,e){return function(t,e={}){const{schema:n={fields:[]},dictionaries:s,records:i}=t,{version:a,fields:c}=n,u=new Map,o=function(t,e,n){const s={version:e,options:t,dictionary:t=>n.get(t)};return t=>{const{length:e,nodes:n,regions:r,variadic:i,body:a}=t;let c=-1,u=-1,o=-1;return{...s,length:e,node:()=>n[++c],buffer:t=>{const{length:e,offset:n}=r[++u];return t?new t(a.buffer,a.byteOffset+n,e/t.BYTES_PER_ELEMENT):a.subarray(n,n+e)},variadic:()=>i[++o],visit(t){return t.map((t=>En(t.type,this)))}}}}(e,a,u),d=new Map;!function(t,e){t.fields.forEach((function t(n){e(n),n.type.dictionary?.children?.forEach(t),n.type.children?.forEach(t)}))}(n,(t=>{const e=t.type;e.typeId===r.Dictionary&&d.set(e.id,e.dictionary)}));const l=new Map;for(const t of s){const{id:e,data:n,isDelta:s,body:r}=t,i=d.get(e),a=En(i,o({...n,body:r}));if(l.has(e)){const t=l.get(e);s||t.clear(),t.add(a)}else{if(s)throw new Error("Delta update can not be first dictionary batch.");l.set(e,nn(i).add(a))}}l.forEach(((t,e)=>u.set(e,t.done())));const h=c.map((t=>nn(t.type)));for(const t of i){const e=o(t);c.forEach(((t,n)=>h[n].add(En(t.type,e))))}return new rn(n,h.map((t=>t.done())),e.useProxy)}(On(t),e)}function En(t,n){const{typeId:s}=t,{length:i,options:a,node:c,buffer:u,variadic:d,version:l}=n,h=an(t,a);if(s===r.Null)return new h({length:i,nullCount:i,type:t});const f={...c(),type:t};switch(s){case r.Bool:case r.Int:case r.Time:case r.Duration:case r.Float:case r.Decimal:case r.Date:case r.Timestamp:case r.Interval:case r.FixedSizeBinary:return new h({...f,validity:u(),values:u(t.values)});case r.Utf8:case r.LargeUtf8:case r.Binary:case r.LargeBinary:return new h({...f,validity:u(),offsets:u(t.offsets),values:u()});case r.BinaryView:case r.Utf8View:return new h({...f,validity:u(),values:u(),data:Array.from({length:d()},(()=>u()))});case r.List:case r.LargeList:case r.Map:return new h({...f,validity:u(),offsets:u(t.offsets),children:n.visit(t.children)});case r.ListView:case r.LargeListView:return new h({...f,validity:u(),offsets:u(t.offsets),sizes:u(t.offsets),children:n.visit(t.children)});case r.FixedSizeList:case r.Struct:return new h({...f,validity:u(),children:n.visit(t.children)});case r.RunEndEncoded:return new h({...f,children:n.visit(t.children)});case r.Dictionary:{const{id:e,indices:s}=t;return new h({...f,validity:u(),values:u(s.values)}).setDictionary(n.dictionary(e))}case r.Union:return l<e.V5&&u(),new h({...f,typeIds:u(y),offsets:t.mode===o.Sparse?null:u(t.offsets),children:n.visit(t.children)});default:throw new Error(M(s))}}function Dn(t,e,n){t[e]=n,t[e+1]=n>>8,t[e+2]=n>>16,t[e+3]=n>>24}const An=1024;class Nn{constructor(t){this.sink=t,this.minalign=1,this.buf=new Uint8Array(An),this.space=An,this.vtables=[],this.outputBytes=0}offset(){return this.buf.length-this.space}writeInt8(t){this.buf[this.space-=1]=t}writeInt16(t){this.buf[this.space-=2]=t,this.buf[this.space+1]=t>>8}writeInt32(t){Dn(this.buf,this.space-=4,t)}writeInt64(t){const e=BigInt(t);this.writeInt32(Number(BigInt.asIntN(32,e>>BigInt(32)))),this.writeInt32(Number(BigInt.asIntN(32,e)))}addInt8(t){Sn(this,1,0),this.writeInt8(t)}addInt16(t){Sn(this,2,0),this.writeInt16(t)}addInt32(t){Sn(this,4,0),this.writeInt32(t)}addInt64(t){Sn(this,8,0),this.writeInt64(t)}addOffset(t){Sn(this,Xt,0),this.writeInt32(this.offset()-t+Xt)}addObject(t,e){const n=function(t,e){const n=Array(e).fill(0),s=t.offset();function r(e){n[e]=t.offset()}return{addInt8(e,n,s){n!=s&&(t.addInt8(n),r(e))},addInt16(e,n,s){n!=s&&(t.addInt16(n),r(e))},addInt32(e,n,s){n!=s&&(t.addInt32(n),r(e))},addInt64(e,n,s){n!=s&&(t.addInt64(n),r(e))},addOffset(e,n,s){n!=s&&(t.addOffset(n),r(e))},finish(){t.addInt32(0);const r=t.offset();let i=e;for(;--i>=0&&0===n[i];);const a=i+1;for(;i>=0;--i)t.addInt16(n[i]?r-n[i]:0);const c=2;t.addInt16(r-s);const u=2*(a+c);t.addInt16(u);let o=0;const{buf:d,vtables:l,space:h}=t;t:for(i=0;i<l.length;++i){const t=d.length-l[i];if(u==ee(d,t)){for(let e=2;e<u;e+=2)if(ee(d,h+e)!=ee(d,t+e))continue t;o=l[i];break}}if(o)t.space=d.length-r,Dn(d,t.space,o-r);else{const e=t.offset();l.push(e),Dn(d,d.length-r,e-r)}return r}}}(this,t);return e?.(n),n.finish()}addVector(t,e,n,s){const r=t?.length;if(!r)return 0;Sn(this,Xt,e*r),Sn(this,n,e*r);for(let e=r;--e>=0;)s(this,t[e]);return this.writeInt32(r),this.offset()}addOffsetVector(t){return this.addVector(t,4,4,((t,e)=>t.addOffset(e)))}addString(t){if(null==t)return 0;const e=Gt(t),n=e.length;return this.addInt8(0),Sn(this,Xt,n),this.buf.set(e,this.space-=n),this.writeInt32(n),this.offset()}finish(t){Sn(this,this.minalign,Xt),this.addOffset(t)}flush(){const{buf:t,sink:e}=this,n=t.subarray(this.space,t.length);e.write(n),this.outputBytes+=n.byteLength,this.minalign=1,this.vtables=[],this.buf=new Uint8Array(An),this.space=An}addBuffer(t){const e=t.byteLength;if(!e)return 0;this.sink.write(t),this.outputBytes+=e;const n=(e+7&-8)-e;return this.addPadding(n),e+n}addPadding(t){t>0&&(this.sink.write(new Uint8Array(t)),this.outputBytes+=t)}}function Sn(t,e,n){let{buf:s,space:r,minalign:i}=t;e>i&&(t.minalign=e);const a=s.length,c=a-r+n,u=1+~c&e-1;s=A(s,c+u+e-1,!0),r+=s.length-a;for(let t=0;t<u;++t)s[--r]=0;t.buf=s,t.space=r}function Bn(t,e){const{nodes:n,regions:s,variadic:r}=e,i=t.addVector(n,16,8,((t,e)=>(t.writeInt64(e.nullCount),t.writeInt64(e.length),t.offset()))),a=t.addVector(s,16,8,((t,e)=>(t.writeInt64(e.length),t.writeInt64(e.offset),t.offset()))),c=t.addVector(r,8,8,((t,e)=>t.addInt64(e)));return t.addObject(5,(t=>{t.addInt64(0,n[0].length,0),t.addOffset(1,i,0),t.addOffset(2,a,0),t.addOffset(4,c,0)}))}function Mn(t,e){const n=Bn(t,e.data);return t.addObject(3,(t=>{t.addInt64(0,e.id,0),t.addOffset(1,n,0),t.addInt8(2,+e.isDelta,0)}))}function Cn(t,e){return e?.size>0?t.addOffsetVector(Array.from(e,(([e,n])=>{const s=t.addString(`${e}`),r=t.addString(`${n}`);return t.addObject(2,(t=>{t.addOffset(0,s,0),t.addOffset(1,r,0)}))}))):0}function Un(t,e){switch(S(e.typeId,r,M)){case r.Dictionary:return function(t,e){const n=function(t){return t.typeId===r.Int&&32===t.bitWidth&&t.signed}(e.indices)?0:Un(t,e.indices);return t.addObject(4,(t=>{t.addInt64(0,e.id,0),t.addOffset(1,n,0),t.addInt8(2,+e.ordered,0)}))}(t,e);case r.Int:return function(t,e){return t.addObject(2,(t=>{t.addInt32(0,e.bitWidth,0),t.addInt8(1,+e.signed,0)}))}(t,e);case r.Float:return function(t,e){return t.addObject(1,(t=>{t.addInt16(0,e.precision,i.HALF)}))}(t,e);case r.Decimal:return function(t,e){return t.addObject(3,(t=>{t.addInt32(0,e.precision,0),t.addInt32(1,e.scale,0),t.addInt32(2,e.bitWidth,128)}))}(t,e);case r.Date:return function(t,e){return t.addObject(1,(t=>{t.addInt16(0,e.unit,a.MILLISECOND)}))}(t,e);case r.Time:return function(t,e){return t.addObject(2,(t=>{t.addInt16(0,e.unit,c.MILLISECOND),t.addInt32(1,e.bitWidth,32)}))}(t,e);case r.Timestamp:return function(t,e){const n=t.addString(e.timezone);return t.addObject(2,(t=>{t.addInt16(0,e.unit,c.SECOND),t.addOffset(1,n,0)}))}(t,e);case r.Interval:return function(t,e){return t.addObject(1,(t=>{t.addInt16(0,e.unit,u.YEAR_MONTH)}))}(t,e);case r.Duration:return function(t,e){return t.addObject(1,(t=>{t.addInt16(0,e.unit,c.MILLISECOND)}))}(t,e);case r.FixedSizeBinary:case r.FixedSizeList:return function(t,e){return t.addObject(1,(t=>{t.addInt32(0,e.stride,0)}))}(t,e);case r.Map:return function(t,e){return t.addObject(1,(t=>{t.addInt8(0,+e.keysSorted,0)}))}(t,e);case r.Union:return function(t,e){const n=t.addVector(e.typeIds,4,4,((t,e)=>t.addInt32(e)));return t.addObject(2,(t=>{t.addInt16(0,e.mode,o.Sparse),t.addOffset(1,n,0)}))}(t,e)}return t.addObject(0)}const Vn=1===new Uint16Array(new Uint8Array([1,0]).buffer)[0];function Tn(t,e){const{fields:n,metadata:s}=e,r=n.map((e=>Fn(t,e))),i=t.addOffsetVector(r),a=Cn(t,s);return t.addObject(4,(t=>{t.addInt16(0,+!Vn,0),t.addOffset(1,i,0),t.addOffset(2,a,0)}))}function Fn(t,e){const{name:n,nullable:s,type:i,metadata:a}=e;let{typeId:c}=i,u=0,o=0;if(c!==r.Dictionary)u=Un(t,i);else{const e=i.dictionary;c=e.typeId,o=Un(t,i),u=Un(t,e)}const d=(i.children||[]).map((e=>Fn(t,e))),l=t.addOffsetVector(d),h=Cn(t,a),f=t.addString(n);return t.addObject(7,(t=>{t.addOffset(0,f,0),t.addInt8(1,+s,0),t.addInt8(2,c,r.NONE),t.addOffset(3,u,0),t.addOffset(4,o,0),t.addOffset(5,l,0),t.addOffset(6,h,0)}))}function jn(t,{offset:e,metadataLength:n,bodyLength:s}){return t.writeInt64(s),t.writeInt32(0),t.writeInt32(n),t.writeInt64(e),t.offset()}function kn(t,n,r,i,a){t.finish(t.addObject(5,(t=>{t.addInt16(0,e.V5,e.V1),t.addInt8(1,n,s.NONE),t.addOffset(2,r,0),t.addInt64(3,i,0)})));const c=t.offset(),u=c+8+7&-8;a?.push({offset:t.outputBytes,metadataLength:u,bodyLength:i}),t.addInt32(u-8),t.addInt32(-1),t.flush(),t.addPadding(u-c-8)}class Rn{write(t){}pad(t){this.write(new Uint8Array(t))}finish(){return null}}class zn extends Rn{constructor(){super(),this.buffers=[]}write(t){this.buffers.push(t)}finish(){const t=this.buffers,e=t.reduce(((t,e)=>t+e.byteLength),0),n=new Uint8Array(e);for(let e=0,s=0;e<t.length;++e)n.set(t[e],s),s+=t[e].byteLength;return n}}const _n="stream",$n="file";function Yn(n,{sink:r,format:i=_n}={}){if(i!==_n&&i!==$n)throw new Error(`Unrecognized Arrow IPC format: ${i}`);const{schema:a,dictionaries:c=[],records:u=[],metadata:o}=n,d=new Nn(r||new zn),l=i===$n,h=[],f=[];l?d.addBuffer(t):a&&kn(d,s.Schema,Tn(d,a),0);for(const t of c){const{data:e}=t;kn(d,s.DictionaryBatch,Mn(d,t),e.byteLength,h),Hn(d,e.buffers)}for(const t of u)kn(d,s.RecordBatch,Bn(d,t),t.byteLength,f),Hn(d,t.buffers);return l&&function(n,s,r,i,a){const c=Cn(n,a),u=n.addVector(i,24,8,jn),o=n.addVector(r,24,8,jn),d=Tn(n,s);n.finish(n.addObject(5,(t=>{t.addInt16(0,e.V5,e.V1),t.addOffset(1,d,0),t.addOffset(2,o,0),t.addOffset(3,u,0),t.addOffset(4,c,0)})));const l=n.offset();n.addInt32(0),n.addInt32(-1),n.flush(),n.sink.write(new Uint8Array(Int32Array.of(l).buffer)),n.sink.write(t)}(d,a,h,f,o),d.sink}function Hn(t,e){for(let n=0;n<e.length;++n)t.addBuffer(e[n])}function Pn(t,e){"string"==typeof e&&(e={format:e});const n=t.children;!function(t){const e=t[0]?.data.map((t=>t.length));t.forEach((({data:t})=>{if(t.length!==e.length||t.some(((t,n)=>t.length!==e[n])))throw new Error("Columns have inconsistent batch sizes.")}))}(n);const{dictionaries:s,idMap:i}=function(t){const e=[],n=new Map,s=new Map;let r=-1;const i=t=>{if(n.has(t))s.set(t.type,n.get(t));else{n.set(t,++r);for(let n=0;n<t.data.length;++n)e.push({id:r,isDelta:n>0,data:Gn([t],n)});s.set(t.type,r)}};return t.forEach((t=>Wn(t.data[0],i))),{dictionaries:e,idMap:s}}(n),a=function(t){return(t[0]?.data||[]).map(((e,n)=>Gn(t,n)))}(n),c=function(t,e){if(!e.size)return t;const n=t=>{t.typeId===r.Dictionary&&(t.id=e.get(t.dictionary),i(t)),t.children&&(t.children=t.children.slice()).forEach(s)},s=(t,e,s)=>{const r={...t.type};s[e]={...t,type:r},n(r)},i=t=>{const e={...t.dictionary};t.dictionary=e,n(e)};return t={...t,fields:t.fields.slice()},t.fields.forEach(s),t}(t.schema,i);return Yn({schema:c,dictionaries:s,records:a},e).finish()}function Wn(t,e){if(t?.type.typeId===r.Dictionary){const n=t.dictionary;e(n),Wn(n.data[0],e)}t?.children?.forEach((t=>Wn(t,e)))}function Gn(t,e=0){const n=function(){let t=0;const e=[],n=[],s=[],r=[];return{node(t,n){e.push({length:t,nullCount:n})},buffer(e){const r=e.byteLength,i=r+7&-8;n.push({offset:t,length:i}),t+=i,s.push(new Uint8Array(e.buffer,e.byteOffset,r))},variadic(t){r.push(t)},children(t,e){t.children.forEach(((t,n)=>{Jn(t.type,e.children[n],this)}))},done:()=>({byteLength:t,nodes:e,regions:n,variadic:r,buffers:s})}}();return t.forEach((t=>{Jn(t.type,t.data[e],n)})),n.done()}function Jn(t,e,n){const{typeId:s}=t;if(s!==r.Null)switch(n.node(e.length,e.nullCount),s){case r.Bool:case r.Int:case r.Time:case r.Duration:case r.Float:case r.Date:case r.Timestamp:case r.Decimal:case r.Interval:case r.FixedSizeBinary:case r.Dictionary:return n.buffer(e.validity),void n.buffer(e.values);case r.Utf8:case r.LargeUtf8:case r.Binary:case r.LargeBinary:return n.buffer(e.validity),n.buffer(e.offsets),void n.buffer(e.values);case r.BinaryView:case r.Utf8View:return n.buffer(e.validity),n.buffer(e.values),n.variadic(e.data.length),void e.data.forEach((t=>n.buffer(t)));case r.List:case r.LargeList:case r.Map:return n.buffer(e.validity),n.buffer(e.offsets),void n.children(t,e);case r.ListView:case r.LargeListView:return n.buffer(e.validity),n.buffer(e.offsets),n.buffer(e.sizes),void n.children(t,e);case r.FixedSizeList:case r.Struct:return n.buffer(e.validity),void n.children(t,e);case r.RunEndEncoded:return void n.children(t,e);case r.Union:return n.buffer(e.typeIds),t.mode===o.Dense&&n.buffer(e.offsets),void n.children(t,e);default:throw new Error(M(s))}}function Xn(t){return new qn(t)}class qn{constructor(t=d){this.buf=new t(512)}array(t){return function(t,e=t.length){const n=function(t,e=1){return(t*e+7&-8)/e}(e,t.BYTES_PER_ELEMENT);return t.length>n?t.subarray(0,n):t.length<n?D(t,n):t}(this.buf,t)}prep(t){t>=this.buf.length&&(this.buf=A(this.buf,t))}get(t){return this.buf[t]}set(t,e){this.prep(e),this.buf[e]=t}write(t,e){this.prep(e+t.length),this.buf.set(t,e)}}function Kn(){return new Qn}class Qn extends qn{set(t){const e=t>>3;this.prep(e),this.buf[e]|=1<<t%8}}class Zn{constructor(t,e){this.type=t,this.ctx=e,this.batchClass=e.batchType(t)}init(){return this.index=-1,this}set(t,e){return this.index=e,!1}done(){return null}batch(){const t=new this.batchClass(this.done());return this.init(),t}}class ts extends Zn{constructor(t,e){super(t,e)}init(){return this.nullCount=0,this.validity=Kn(),super.init()}set(t,e){this.index=e;const n=null!=t;return n?this.validity.set(e):this.nullCount++,n}done(){const{index:t,nullCount:e,type:n,validity:s}=this;return{length:t+1,nullCount:e,type:n,validity:e?s.array(1+(t>>3)):new d(0)}}}function es(){const t=new Map,e=new Set;return{get(n,s){const r=n.id;if(r>=0&&t.has(r))return t.get(r);{const i=function(t,e){const n=Object.create(null),s=e.builder(t.dictionary),r=[];s.init();let i=-1;return{type:t,values:s,add:t=>(r.push(t),t),key(t){const e=Jt(t);let r=n[e];return void 0===r&&(n[e]=r=++i,s.set(t,r)),r},finish(e){const n=new(an(t.dictionary,e))(s.done()),i=new sn([n]);r.forEach((t=>t.setDictionary(i)))}}}(n,s);return r>=0&&t.set(r,i),e.add(i),i}},finish(t){e.forEach((e=>e.finish(t)))}}}class ns extends ts{constructor(t,e){super(t,e),this.dict=e.dictionary(t)}init(){return this.values=Xn(this.type.indices.values),super.init()}set(t,e){super.set(t,e)&&this.values.set(this.dict.key(t),e)}done(){return{...super.done(),values:this.values.array(this.index+1)}}batch(){return this.dict.add(super.batch())}}function ss(t){const e=rs();return t((t=>e.add(t))),e.type()}function rs(){let t,e,n,s=0,r=0,i=0,a=0,c=0,u=0,o=0,d=0,l=0,h=0,f=0,y=1/0,p=-1/0,I=1/0,g=-1/0,b={};return{add(v){if(s++,null!=v)switch(typeof v){case"string":l++;break;case"number":a++,v<y&&(y=v),v>p&&(p=v),Number.isInteger(v)&&c++;break;case"bigint":u++,void 0===t?t=e=v:(v<t&&(t=v),v>e&&(e=v));break;case"boolean":i++;break;case"object":if(v instanceof Date)o++,+v%864e5==0&&d++;else if(O(v)){h++;const t=v.length;t<I&&(I=t),t>g&&(g=t),n??=rs(),v.forEach(n.add)}else{f++;for(const t in v){(b[t]??(b[t]=rs())).add(v[t])}}}else r++},type(){const v=s-r;return 0===v?k():c===v?function(t,e){const n=Math.max(Math.abs(t)-1,e);return n<128?z():n<32768?_():n<2**31?$():K()}(y,p):a===v?K():u===v?function(t,e){const n=-t>e?-t-1n:e;if(n>=2**63)throw new Error(`BigInt exceeds 64 bits: ${n}`);return Y()}(t,e):i===v?tt():d===v?st():o===v?dt():l===v?j(Z()):h===v?function(t,e,n){return n===e?It(t,e):ht(t)}(n.type(),I,g):f===v?ft(Object.entries(b).map((t=>C(t[0],t[1].type())))):function(){throw new Error("Mixed types detected, please define a union type.")}()}}}class is extends ts{constructor(t,e){super(t,e),this.toOffset=Ft(t.offsets)}init(){return this.offsets=Xn(this.type.offsets),this.values=Xn(),this.pos=0,super.init()}set(t,e){const{offsets:n,values:s,toOffset:r}=this;super.set(t,e)&&(s.write(t,this.pos),this.pos+=t.length),n.set(r(this.pos),e+1)}done(){return{...super.done(),offsets:this.offsets.array(this.index+2),values:this.values.array(this.pos+1)}}}class as extends ts{constructor(t,e){super(t,e)}init(){return this.values=Kn(),super.init()}set(t,e){super.set(t,e),t&&this.values.set(e)}done(){return{...super.done(),values:this.values.array(1+(this.index>>3))}}}class cs extends ts{constructor(t,e){super(t,e),this.scale=10**t.scale,this.stride=t.bitWidth>>6}init(){return this.values=Xn(this.type.values),super.init()}set(t,e){const{scale:n,stride:s,values:r}=this;super.set(t,e)&&(r.prep((e+1)*s),function(t,e,n,s,r){const i="bigint"==typeof t?t:Tt(Math.trunc(t*r));e[n]=i,e[n+1]=i>>64n,s>2&&(e[n+2]=i>>128n,e[n+3]=i>>192n)}(t,r.buf,e*s,s,n))}done(){const{index:t,stride:e,values:n}=this;return{...super.done(),values:n.array((t+1)*e)}}}class us extends ts{constructor(t,e){super(t,e),this.stride=t.stride}init(){return this.values=Xn(),super.init()}set(t,e){super.set(t,e)&&this.values.write(t,e*this.stride)}done(){const{stride:t,values:e}=this;return{...super.done(),values:e.array(t*(this.index+1))}}}class os extends ts{constructor(t,e){super(t,e),this.child=e.builder(this.type.children[0].type),this.stride=t.stride}init(){return this.child.init(),super.init()}set(t,e){const{child:n,stride:s}=this,r=e*s;if(super.set(t,e))for(let e=0;e<s;++e)n.set(t[e],r+e);else n.index=r+s}done(){const{child:t}=this;return{...super.done(),children:[t.batch()]}}}class ds extends ts{init(){return this.values=Xn(this.type.values),super.init()}set(t,e){if(super.set(t,e)){const n=e<<1;this.values.set(t[0],n),this.values.set(t[1],n+1)}}done(){return{...super.done(),values:this.values.array(this.index+1<<1)}}}class ls extends ts{init(){return this.values=Xn(),super.init()}set(t,e){super.set(t,e)&&this.values.write(function([t,e,n]){return Ct[0]=t,Ct[1]=e,Bt[1]=Tt(n),Ut}(t),e<<4)}done(){return{...super.done(),values:this.values.array(this.index+1<<4)}}}class hs extends ts{constructor(t,e,n){super(t,e),this.child=n}init(){this.child.init();const t=this.type.offsets;return this.offsets=Xn(t),this.toOffset=Ft(t),this.pos=0,super.init()}done(){return{...super.done(),offsets:this.offsets.array(this.index+2),children:[this.child.batch()]}}}class fs extends hs{constructor(t,e){super(t,e,e.builder(t.children[0].type))}set(t,e){const{child:n,offsets:s,toOffset:r}=this;super.set(t,e)&&t.forEach((t=>n.set(t,this.pos++))),s.set(r(this.pos),e+1)}}class ys extends ts{constructor(t,e){super(t,e),this.children=t.children.map((t=>e.builder(t.type)))}init(){return this.children.forEach((t=>t.init())),super.init()}done(){const{children:t}=this;return t.forEach((t=>t.index=this.index)),{...super.done(),children:t.map((t=>t.batch()))}}}class ps extends ys{constructor(t,e){super(t,e),this.setters=this.children.map(((e,n)=>{const s=t.children[n].name;return(t,n)=>e.set(t?.[s],n)}))}set(t,e){super.set(t,e);const n=this.setters;for(let s=0;s<n.length;++s)n[s](t,e)}}class Is extends hs{constructor(t,e){super(t,e,new gs(t.children[0].type,e))}set(t,e){const{child:n,offsets:s,toOffset:r}=this;if(super.set(t,e))for(const e of t)n.set(e,this.pos++);s.set(r(this.pos),e+1)}}class gs extends ys{set(t,e){super.set(t,e);const[n,s]=this.children;n.set(t[0],e),s.set(t[1],e)}}const bs={};class vs extends Zn{constructor(t,e){super(t,e),this.children=t.children.map((t=>e.builder(t.type)))}init(){return this.pos=0,this.key=null,this.value=bs,this.children.forEach((t=>t.init())),super.init()}next(){const[t,e]=this.children;t.set(this.index+1,this.pos),e.set(this.value,this.pos++)}set(t,e){if(t!==this.value){const e=Jt(t);e!==this.key&&(this.key&&this.next(),this.key=e,this.value=t)}this.index=e}done(){this.next();const{children:t,index:e,type:n}=this;return{length:e+1,nullCount:0,type:n,children:t.map((t=>t.batch()))}}}class ws extends Zn{constructor(t,e){super(t,e),this.children=t.children.map((t=>e.builder(t.type))),this.typeMap=t.typeMap,this.lookup=t.typeIdForValue}init(){return this.nullCount=0,this.typeIds=Xn(y),this.children.forEach((t=>t.init())),super.init()}set(t,e){const{children:n,lookup:s,typeMap:r,typeIds:i}=this;this.index=e;const a=s(t,e),c=n[r[a]];i.set(a,e),null==t&&++this.nullCount,this.update(t,e,c)}done(){const{children:t,nullCount:e,type:n,typeIds:s}=this,r=this.index+1;return{length:r,nullCount:e,type:n,typeIds:s.array(r),children:t.map((t=>t.batch()))}}}class ms extends ws{update(t,e,n){n.set(t,e),this.children.forEach((t=>{t!==n&&t.set(null,e)}))}}class xs extends ws{init(){return this.offsets=Xn(this.type.offsets),super.init()}update(t,e,n){const s=n.index+1;n.set(t,s),this.offsets.set(s,e)}done(){return{...super.done(),offsets:this.offsets.array(this.index+1)}}}class Os extends is{set(t,e){super.set(t&&Gt(t),e)}}class Ls extends ts{constructor(t,e){super(t,e),this.values=Xn(t.values)}init(){return this.values=Xn(this.type.values),super.init()}set(t,e){super.set(t,e)&&this.values.set(t,e)}done(){return{...super.done(),values:this.values.array(this.index+1)}}}class Es extends Ls{set(t,e){super.set(null==t?t:Tt(t),e)}}class Ds extends Ls{constructor(t,e,n){super(t,e),this.transform=n}set(t,e){super.set(null==t?t:this.transform(t),e)}}function As(t={},e=es()){return{batchType:e=>an(e,t),builder(t){return Ns(t,this)},dictionary(t){return e.get(t,this)},finish:()=>e.finish(t)}}function Ns(t,e=As()){const{typeId:n}=t;switch(n){case r.Int:case r.Time:case r.Duration:return L(t.values)?new Es(t,e):new Ls(t,e);case r.Float:return t.precision?new Ls(t,e):new Ds(t,e,Yt);case r.Binary:case r.LargeBinary:return new is(t,e);case r.Utf8:case r.LargeUtf8:return new Os(t,e);case r.Bool:return new as(t,e);case r.Decimal:return new cs(t,e);case r.Date:return new Ds(t,e,t.unit?Tt:jt);case r.Timestamp:return new Ds(t,e,(s=t.unit)===c.SECOND?t=>Tt(t/1e3):s===c.MILLISECOND?Tt:s===c.MICROSECOND?t=>Tt(1e3*t):t=>Tt(1e6*t));case r.Interval:switch(t.unit){case u.DAY_TIME:return new ds(t,e);case u.MONTH_DAY_NANO:return new ls(t,e)}return new Ls(t,e);case r.List:case r.LargeList:return new fs(t,e);case r.Struct:return new ps(t,e);case r.Union:return t.mode?new xs(t,e):new ms(t,e);case r.FixedSizeBinary:return new us(t,e);case r.FixedSizeList:return new os(t,e);case r.Map:return new Is(t,e);case r.RunEndEncoded:return new vs(t,e);case r.Dictionary:return new ns(t,e)}var s;throw new Error(M(n))}function Ss(t,e,n={},s){const i="function"==typeof t[Symbol.iterator]?e=>{for(const n of t)e(n)}:t;e??=ss(i);const{maxBatchRows:a=1/0,...c}=n;let u;if(e.typeId===r.Null){let t=0;i((()=>++t)),u=function(t,e,n){const s=[],r=e=>new pe({length:e,nullCount:e,type:t}),i=Math.floor(e/n);for(let t=0;t<i;++t)s.push(r(n));const a=e%n;a&&s.push(r(a));return s}(e,t,a)}else{const t=As(c,s),n=Ns(e,t).init(),r=t=>u.push(t.batch());u=[];let o=0;i((t=>{n.set(t,o++),o>=a&&(r(n),o=0)})),o&&r(n),t.finish()}return new sn(u,e)}function Bs(t,e,n={},s){return!e&&x(t)?function(t,{maxBatchRows:e,useBigInt:n}){const s=t.constructor,r=function(t){switch(t){case b:return q();case v:return K();case y:return z();case p:return _();case I:return $();case g:return Y();case d:return H();case l:return P();case h:return W();case f:return G()}}(s),i=t.length,a=Math.min(e||1/0,i),c=Math.floor(i/a),u=[],o=L(s)&&!n?Ie:he,w=(e,n)=>u.push(new o({length:n-e,nullCount:0,type:r,validity:new d(0),values:t.subarray(e,n)}));let m=0;for(let t=0;t<c;++t)w(m,m+=a);m<i&&w(m,i);return new sn(u)}(t,n):Ss((e=>t.forEach(e)),e,n,s)}function Ms(t,s){const r=[],i=Array.isArray(t)?t:Object.entries(t),a=i[0]?.[1].length,c=i.map((([t,e])=>{if(e.length!==a)throw new Error("All columns must have the same length.");return r.push(C(t,e.type)),e})),u={version:e.V5,endianness:n.Little,fields:r,metadata:null};return new rn(u,c,s)}function Cs(t,e={}){const{types:n={},...s}=e,r=es();return Ms((Array.isArray(t)?t:Object.entries(t)).map((([t,e])=>[t,Bs(e,n[t],s,r)])),e.useProxy)}export{le as Batch,sn as Column,a as DateUnit,n as Endianness,u as IntervalUnit,i as Precision,rn as Table,c as TimeUnit,r as Type,o as UnionMode,e as Version,an as batchType,Q as binary,Lt as binaryView,tt as bool,Bs as columnFromArray,Ss as columnFromValues,nt as date,st as dateDay,rt as dateMillisecond,et as decimal,j as dictionary,es as dictionaryContext,vt as duration,C as field,pt as fixedSizeBinary,It as fixedSizeList,J as float,X as float16,q as float32,K as float64,R as int,_ as int16,$ as int32,Y as int64,z as int8,lt as interval,wt as largeBinary,xt as largeList,At as largeListView,mt as largeUtf8,ht as list,Dt as listView,bt as map,k as nullType,Ot as runEndEncoded,ft as struct,Cs as tableFromArrays,Ms as tableFromColumns,Ln as tableFromIPC,Pn as tableToIPC,it as time,ut as timeMicrosecond,ct as timeMillisecond,ot as timeNanosecond,at as timeSecond,dt as timestamp,P as uint16,W as uint32,G as uint64,H as uint8,yt as union,Z as utf8,Et as utf8View};export default null;
